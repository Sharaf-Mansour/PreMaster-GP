@inject NavigationService WFS
@inject ProtectedLocalStorage BrowserStorage

<div class="container content-space-1 content-space-t-lg-0 content-space-b-lg-2 mt-lg-n10 zi-999 w-75 w-sm-100 w-lg-75 fs-5">
    <div class="row" style="margin-top:300px ">
        <div class="col-lg-3">
            <div class="navbar-expand-lg navbar-light">
                <div id="sidebarNav" class="collapse navbar-collapse navbar-vertical">
                    <div class="card flex-grow-1 mb-5">
                        <div class="card-body">
                            <div class="d-none d-lg-block text-center mb-5">
                  <div class="avatar avatar-xxl avatar-circle mb-3">
                                    <img class="avatar-img" src="./assets/img/160x160/img99.jpg" alt="Image Description">
@*                                    <img class="avatar-status avatar-lg-status" src="./assets/svg/illustrations/top-vendor.svg" alt="Image Description" data-bs-toggle="tooltip" data-bs-placement="top" title="Verified user">
*@                                </div>@*              
                                <h4 class="card-title mb-0">User Name</h4>
                                <p class="card-text small">Student ID 202101236</p>*@
                            </div>
                            <span class="text-cap">Account</span>
                            <ul class="nav nav-sm nav-tabs nav-vertical mb-4">
                                <li class="nav-item">                                                              
                                    <a class='nav-link @(WFS.Page is "StudentProfile" ? "active" : "")' href="/" @onclick='((e)=>OnClick( e, "StudentProfile"))'>
                                        <i class="bi-person-badge nav-icon"></i> User profile
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class='nav-link @(WFS.Page is "AccountSecurity" ? "active" : "")' href="/" @onclick='((e)=>OnClick( e, "AccountSecurity"))'>
                                        <i class="bi-shield-shaded nav-icon"></i> Security
                                    </a>
                                </li>
                              @*  <li class="nav-item">
                                    <a class='nav-link dis @(WFS.Page is "Notifications" ? "active" : "")' href="/"  >
                                        <i class="bi-bell nav-icon"></i> Notifications
                                        <span class="badge bg-soft-dark text-dark rounded-pill nav-link-badge">1</span>
                                    </a>
                                </li>*@
                            </ul>
                            <span class="text-cap">Uni Connect</span>
                            <ul class="nav nav-sm nav-tabs nav-vertical mb-4">
                                <li class="nav-item">
                                    <a class='nav-link @(WFS.Page is "StudyPrograms" ? "active" : "")' href="/" @onclick='((e)=>OnClick( e, "StudyPrograms"))'>
                                        <i class="bi-basket nav-icon"></i> Study Programs
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class='nav-link @(WFS.Page is "Wishlist" ? "active" : "")' href="/" @onclick='((e)=>OnClick( e, "Wishlist"))'>
                                        <i class="bi-heart nav-icon"></i> Wishlist
                                        <span class="badge bg-soft-dark text-dark rounded-pill nav-link-badge">2</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class='nav-link @(WFS.Page is "MyApplications" ? "active" : "")' href="/" @onclick='((e)=>OnClick( e, "MyApplications"))'>
                                        @* <a class="nav-link active" href="/"  @onclick='((e)=>OnClick( e, "MyApplications"))'>*@
                                        <i class="bi-heart nav-icon"></i> My applications
                                        <span class="badge bg-soft-dark text-dark rounded-pill nav-link-badge">2</span>
                                    </a>
                                </li>
                            </ul>
                            <span class="text-cap ">Plus Membership</span>
                            <ul class="nav nav-sm nav-tabs nav-vertical">
                                <li class="nav-item ">
                                    <a class="nav-link disabled" href="/">
                                        <i class="bi-credit-card nav-icon"></i> My Schadule
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link disabled " href="/">
                                        <i class="bi-geo-alt nav-icon"></i> Matrials
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link disabled" href="/">
                                        <i class="bi-people nav-icon"></i>Leactures
                                    </a>
                                </li>
                                <li class="nav-item ">
                                    <a class="nav-link disabled " href="/">
                                        <i class="bi-people nav-icon"></i>Your results
                                    </a>
                                </li>
                                <li class="nav-item ">
                                    <a class="nav-link disabled " href="/">
                                        <i class="bi-people nav-icon"></i>Your requests
                                    </a>
                                </li>
                                <li class="nav-item ">
                                    <a class="nav-link disabled " href="/">
                                        <i class="bi-people nav-icon"></i>Projects Groups
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @if (WFS.Page is "StudentProfile")
        {
            <StudentProfile OnClickCallback="()=>stateHasChanged()" />
        }
        else if (WFS.Page is "StudyPrograms")
        {
            <StudyPrograms OnClickCallback="()=>stateHasChanged()" />
        }
        else if (WFS.Page is "MyApplications")
        {
            <MyApplications OnClickCallback="()=>stateHasChanged()" />
        }
        else if (WFS.Page is "AccountSecurity")
        {
            <AccountSecurity OnClickCallback="()=>stateHasChanged()" />
        }  
        else if (WFS.Page is "Wishlist")
        {
            <Wishlist OnClickCallback="()=>stateHasChanged()" />
        }
        else
        { }
    </div>
</div>
@code {
    public EditContext? editContext;
    protected override void OnInitialized()
    {
        editContext = new(model);
        editContext?.SetFieldCssClassProvider(new CustomFieldClassProvider());
        WFS.OnChange += StateHasChanged;
        if (!WFS.IsLoggedIn)
        {

            WFS.Page = "Login";
            WFS.NotifyStateChanged();
        }


    }
    public AccountLogin model { get; set; } = new();
    [Parameter]
    public EventCallback<MouseEventArgs> OnClickCallback { get; set; }

    async void OnClick(MouseEventArgs e, string page)
    {
        WFS.Page = page;
        if (page is "Login")
        {
            WFS.IsLoggedIn = false;
            await BrowserStorage.SetAsync("IsLoggedIn", false);
            await BrowserStorage.SetAsync("Page", "Login");
        }
        if (!WFS.IsLoggedIn)
        {
            await BrowserStorage.SetAsync("IsLoggedIn", false);
            await BrowserStorage.SetAsync("Page", "Login");
            WFS.Page = "Login";

        }
        await OnClickCallback.InvokeAsync(e);
    }
    async void stateHasChanged()
    {
          if (!WFS.IsLoggedIn)
        {
            await BrowserStorage.SetAsync("IsLoggedIn", false);
            await BrowserStorage.SetAsync("Page", "Login");
            WFS.Page = "Login";
        }
        WFS.NotifyStateChanged();
        StateHasChanged();
    }
}